<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Регистрация на мероприятие</title>
  <style>
    /* Сброс базовых отступов */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html {
      height: 100%;
      font-family: Helvetica, Arial, sans-serif;
    }
    /* Фоновое изображение и затемнённый оверлей */
    .hero {
      background: url('images/background.jpg') center/cover no-repeat;
      position: relative;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1;
    }

    /* Стили для формы UniSender */
    section.hero form#registration-form-api {
        position: relative;
        z-index: 2;
        max-width: 400px; 
        width: 90%;
    }

    /* Сделать фон формы UniSender прозрачным */
    section.hero form[name="subscribtion_form"] table[style*="background-color: rgb(255, 255, 255)"] {
        background-color: transparent !important;
    }

    /* Стили для адаптации формы UniSender */
    form#registration-form-api table[style*="max-width"] {
        max-width: 100% !important; /* Убираем ограничение по ширине */
        background-color: transparent !important; /* Убираем белый фон формы, если он мешает */
    }
    form#registration-form-api td[style*="padding: 25px"] {
        padding: 15px !important; /* Уменьшаем основной отступ */
    }
    form#registration-form-api td[style*="padding: 8px"] {
        padding: 5px 0 !important; /* Уменьшаем отступы ячеек с полями */
    }
    form#registration-form-api label[style*="display: inline-block"] {
        display: block !important; /* Лейблы над полями */
        width: 100% !important;
        text-align: left !important;
        padding-bottom: 3px !important;
        font-size: 0.9rem !important; /* Чуть уменьшим шрифт лейбла */
        color: #ddd !important; /* Делаем текст светлее на тёмном фоне (изменено на #ddd) */
    }
    form#registration-form-api div[style*="display: inline-block"][style*="width: 66%"] {
        width: 100% !important; /* Инпуты на всю ширину */
        display: block !important;
    }
    form#registration-form-api input[type="text"],
    form#registration-form-api input[type="email"],
    form#registration-form-api input[type="tel"] {
        height: auto !important;
        padding: 0.6rem 0.5rem !important; /* Сделаем отступы комфортнее */
        font-size: 1rem !important;
        line-height: 1.4 !important; /* Для лучшей читаемости */
        background-color: rgba(255, 255, 255, 0.9) !important; /* Слегка прозрачный фон полей */
        border: 1px solid #ccc !important;
    }
    form#registration-form-api input[type="checkbox"] {
        width: 18px !important;
        height: 18px !important;
        vertical-align: middle;
        background-color: rgba(255, 255, 255, 0.9) !important;
        accent-color: #757575 !important; /* Цвет галочки чекбокса */
    }
    form#registration-form-api span[style*="font-family:Arial"] {
        font-size: 0.9rem !important; /* Уменьшим текст согласия */
        vertical-align: middle;
        color: #eee !important; /* Делаем текст светлее */
    }
    form#registration-form-api button {
        padding: 0.75rem !important;
        font-size: 1rem !important;
        background-color: #007BFF !important; /* Возвращаем синий цвет кнопке */
        color: white !important;
        border: none !important;
        border-radius: 4px !important; /* Добавляем скругление */
        cursor: pointer;
        width: 100%; /* Кнопка на всю ширину */
    }
    form#registration-form-api td[style*="background-color: rgb(136, 136, 136)"] {
        background-color: transparent !important; /* Убираем серый фон у ячейки кнопки */
        padding: 15px 0 0 0 !important; /* Отступ сверху для кнопки */
    }

    /* Убираем синюю обводку у полей при фокусе */
    section.hero form#registration-form-api input[type="text"]:focus,
    section.hero form#registration-form-api input[type="email"]:focus,
    section.hero form#registration-form-api input[type="tel"]:focus {
        outline: none !important;
        border: 1px solid #aaa !important;
        box-shadow: 0 0 3px rgba(120, 120, 120, 0.5) !important;
    }

    /* Стили для кнопки Регистрация - новая попытка */
    /* Нацеливаемся на TD, которая является родителем кнопки и имеет синий фон */
    section.hero form#registration-form-api table table table td[align="center"][valign="middle"][style*="background-color: #007BFF"] {
        background-color: #B0B0B0 !important; /* Новый серый фон для TD */
    }

    section.hero form#registration-form-api button[type="submit"] {
        background-color: transparent !important; /* Кнопка остается прозрачной, фон от TD */
        color: #333333 !important; /* Темный текст для кнопки */
        width: auto !important; /* Автоматическая ширина по содержимому */
        min-width: 150px; /* Минимальная ширина для читаемости */
        padding: 0.75rem 2rem !important; /* Вертикальные и горизонтальные отступы */
        border: none !important;
        border-radius: 4px !important;
        cursor: pointer;
        font-size: 1rem !important;
        display: inline-block !important; /* Чтобы width: auto работало корректно */
    }

    /* Старый селектор для TD кнопки, на всякий случай оставим, но новый выше должен быть точнее */
    section.hero form#registration-form-api table td[style*="background-color: #007BFF"] { 
        background-color: #B0B0B0 !important; 
    }

    /* Старый селектор для самой кнопки, по сути дублируется */
    /* form#registration-form-api button { ... } */
  </style>
</head>
<body>
  <section class="hero">
      <form method="POST" id="registration-form-api">
        <div class="container responsive"><table cellpadding="0" cellspacing="0" align="center" style="width: 100%; box-sizing: border-box;"><tbody><tr><td>
        <!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]--><table cellpadding="0" cellspacing="0" align="center" style="background-color: transparent !important; border-radius: 0px; max-width: 450px; width: 100%; border: none; margin: 0px auto; border-spacing: 0px; border-collapse: collapse;"><tbody><tr><td width="100%" style="vertical-align: top; max-width: 450px; font-size: 0px; padding: 15px !important;">
        <!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]-->                                    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed; height: auto; border-collapse: collapse; border-spacing: 0px; display: inline-table; vertical-align: top; font-size: medium;">                <tbody>
        <tr>                    <td style="width: 100%; padding: 5px 0 !important; height: 50px;" valign="top">                        <table border="0" cellspacing="0" cellpadding="0" style="height: 100%; width: 100%; table-layout: fixed; border-spacing: 0px; border-collapse: collapse; min-height: 50px;">                            <tbody>
        <tr>                                <td style="width: 100%; font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: rgb(34, 34, 34);">                                            <div style="display:block !important; width:100% !important;font-size:0;">            <label style="font-size: 0.9rem !important; padding: 0px 0px 3px !important; vertical-align: middle; box-sizing: border-box; width: 100% !important; display: block !important; font-family: Arial, Helvetica, sans-serif; color: #ddd !important; text-align: left !important;"><span>Имя</span><b style="font-size:14px;font-family:Georgia;line-height:10px;"> *</b></label>            <div style="display: block !important; width: 100% !important;">                <input type="text" style="border-radius: 3px; font: 13px / 1.4 Arial, Helvetica; padding: 0.6rem 0.5rem !important; width: 100%; box-sizing: border-box; border: 1px solid rgb(204, 204, 204) !important; background-color: rgba(255, 255, 255, 0.9) !important; background-image: none; height: auto !important;" name="f_1" _validator="string" _label="Имя" _required="1" placeholder="">                <div class="error-block" style="display:none;color:#ff592d;font:11px/18px Arial;"></div>            </div>        </div>                                    </td>                            </tr>                        </tbody>
        </table>                    </td>                </tr>            </tbody>
        </table>        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--><!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]-->                                    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed; height: auto; border-collapse: collapse; border-spacing: 0px; display: inline-table; vertical-align: top; font-size: medium;">                <tbody>
        <tr>                    <td style="width: 100%; padding: 5px 0 !important; height: 50px;" valign="top">                        <table border="0" cellspacing="0" cellpadding="0" style="height: 100%; width: 100%; table-layout: fixed; border-spacing: 0px; border-collapse: collapse; min-height: 50px;">                            <tbody>
        <tr>                                <td style="width: 100%; font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: rgb(34, 34, 34);">                                            <div style="display:block !important; width:100% !important;font-size:0;">            <label style="font-size: 0.9rem !important; padding: 0px 0px 3px !important; vertical-align: middle; box-sizing: border-box; width: 100% !important; display: block !important; font-family: Arial, Helvetica, sans-serif; color: #ddd !important; text-align: left !important;"><span>Фамилия</span><b style="font-size:14px;font-family:Georgia;line-height:10px;"> *</b></label>            <div style="display: block !important; width: 100% !important;">                <input type="text" style="border-radius: 3px; font: 13px / 1.4 Arial, Helvetica; padding: 0.6rem 0.5rem !important; width: 100%; box-sizing: border-box; border: 1px solid rgb(204, 204, 204) !important; background-color: rgba(255, 255, 255, 0.9) !important; background-image: none; height: auto !important;" name="f_2" _validator="string" _label="Фамилия" _required="1" placeholder="">                <div class="error-block" style="display:none;color:#ff592d;font:11px/18px Arial;"></div>            </div>        </div>                                    </td>                            </tr>                        </tbody>
        </table>                    </td>                </tr>            </tbody>
        </table>        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--><!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]-->                                    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed; height: auto; border-collapse: collapse; border-spacing: 0px; display: inline-table; vertical-align: top; font-size: medium;">                <tbody>
        <tr>                    <td style="width: 100%; padding: 5px 0 !important; height: 50px;" valign="top">                        <table border="0" cellspacing="0" cellpadding="0" style="height: 100%; width: 100%; table-layout: fixed; border-spacing: 0px; border-collapse: collapse; min-height: 50px;">                            <tbody>
        <tr>                                <td style="width: 100%; font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: rgb(34, 34, 34);">                                            <div style="display:block !important; width:100% !important;font-size:0;">            <label style="font-size: 0.9rem !important; padding: 0px 0px 3px !important; vertical-align: middle; box-sizing: border-box; width: 100% !important; display: block !important; font-family: Arial, Helvetica, sans-serif; color: #ddd !important; text-align: left !important;"><span>Телефон</span><b style="font-size:14px;font-family:Georgia;line-height:10px;"> *</b></label>            <div style="display: block !important; width: 100% !important;">                <input type="text" style="border-radius: 3px; font: 13px / 1.4 Arial, Helvetica; padding: 0.6rem 0.5rem !important; width: 100%; box-sizing: border-box; border: 1px solid rgb(204, 204, 204) !important; background-color: rgba(255, 255, 255, 0.9) !important; background-image: none; height: auto !important;" name="phone" _validator="phone" _label="Телефон" _required="1" placeholder="+7">                <div class="error-block" style="display:none;color:#ff592d;font:11px/18px Arial;"></div>            </div>        </div>                                    </td>                            </tr>                        </tbody>
        </table>                    </td>                </tr>            </tbody>
        </table>        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--><!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]-->                                    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed; height: auto; border-collapse: collapse; border-spacing: 0px; display: inline-table; vertical-align: top; font-size: medium;">                <tbody>
        <tr>                    <td style="width: 100%; padding: 5px 0 !important; height: 50px;" valign="top">                        <table border="0" cellspacing="0" cellpadding="0" style="height: 100%; width: 100%; table-layout: fixed; border-spacing: 0px; border-collapse: collapse; min-height: 50px;">                            <tbody>
        <tr>                                <td style="width: 100%; font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: rgb(34, 34, 34);">                                            <div style="display:block !important; width:100% !important;font-size:0;">            <label style="font-size: 0.9rem !important; padding: 0px 0px 3px !important; vertical-align: middle; box-sizing: border-box; width: 100% !important; display: block !important; font-family: Arial, Helvetica, sans-serif; color: #ddd !important; text-align: left !important;">                <span>E-mail</span>                <b style="font-size:14px;font-family:Georgia;line-height:10px;"> *</b>            </label>            <div style="display: block !important; width: 100% !important;">                <input type="text" name="email" _validator="email" _required="1" style="border-radius: 3px; font: 13px / 1.4 Arial, Helvetica; padding: 0.6rem 0.5rem !important; width: 100%; box-sizing: border-box; border: 1px solid rgb(204, 204, 204) !important; background-color: rgba(255, 255, 255, 0.9) !important; background-image: none; height: auto !important;" _label="E-mail" placeholder="">                <div class="error-block" style="display:none;color:#ff592d;font:11px/18px Arial;"></div>            </div>        </div>                                    </td>                            </tr>                        </tbody>
        </table>                    </td>                </tr>            </tbody>
        </table>        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--><!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]-->                                    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed; height: auto; border-collapse: collapse; border-spacing: 0px; display: inline-table; vertical-align: top; font-size: medium;">                <tbody>
        <tr>                    <td style="width: 100%; padding: 8px; text-align: center;" valign="top">                        <table border="0" cellspacing="0" cellpadding="0" style="height: 100%; width: 100%; table-layout: fixed; border-spacing: 0px; border-collapse: collapse;">                            <tbody>
        <tr>                                <td style="width:100%;">                                            <div style="display:inline-block; width:100%;">            <ul style="margin: 0; padding: 0; display: inline-block;">                <li style="list-style:none; margin: 0; padding: 0; display: inline-block;">                    <input type="checkbox" name="argument-with-terms" data-virtual-name="argument-with-terms" style="font: 12px / 1 Arial, Helvetica; vertical-align: middle; border-radius: 3px; padding: 0px 8px; box-sizing: border-box; border: none; background-color: rgba(255, 255, 255, 0.9) !important; background-image: none; width: 18px !important; height: 18px !important;" _fullerrormessage="Это поле обязательно" _required="1">                    <span style="display: inline-block; padding: 0px 0px 1px; vertical-align: middle; box-sizing: border-box; font-size: 0.9rem !important; color: #ddd !important;" tabindex="0" spellcheck="false" role="textbox" aria-label="false" aria-describedby="cke_35"> <span style="font-family:Arial,Helvetica,sans-serif;">Я согласен с политикой конфиденциальности</span> </span>                </li>            </ul>            <div class="error-block" id="consent-error" style="display:none;color:#ff592d;font:11px/18px Arial;margin-top:4px;"></div>            <div class="error-block" style="display:none;color:#ff592d;font:11px/18px Arial;"></div>        </div>                                    </td>                            </tr>                        </tbody>
        </table>                    </td>                </tr>            </tbody>
        </table>        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--><!--[if (gte mso 9)|(IE)]><table cellpadding="0" cellspacing="0" border="0" width="400" align="center"><tr><td><![endif]-->                                    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="width: 100%; table-layout: fixed; height: auto; border-collapse: collapse; border-spacing: 0px; display: inline-table; vertical-align: top; font-size: medium;">                <tbody>
        <tr>                    <td style="width: 100%; background-image: none; min-height: 0px; height: 0px; padding: 15px 0 0 0 !important;" valign="top">                        <table border="0" cellspacing="0" cellpadding="0" style="height: 100%; width: 100%; table-layout: fixed; border-spacing: 0px; border-collapse: collapse; min-height: 0px;">                            <tbody>
        <tr>                                <td style="width: 100%; text-align: center; font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: rgb(34, 34, 34);">                                            <table border="0" cellpadding="0" cellspacing="0" width="100%" style="display: inline-table; width: auto; border-spacing: 0px; border-collapse: collapse;">            <tbody>
        <tr>                <td align="center" valign="middle" style="border: none !important; border-radius: 4px !important; padding: 0.75rem !important; background-color: #007BFF !important; height: 18.7969px; min-height: 18.7969px;">                    <button type="submit" style="width: 100% !important; display: inline-block; text-decoration: none; word-break: break-all; font-size: 1rem !important; font-family: Arial, Helvetica, sans-serif; line-height: 16.8px; color: white !important; background-color: transparent !important; border: 0px; cursor: pointer;">Регистрация</button>                </td>            </tr>        </tbody>
        </table>                                    </td>                            </tr>                        </tbody>
        </table>                    </td>                </tr>            </tbody>
        </table>        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->
        </td></tr></tbody></table>
        <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->
        </td></tr></tbody></table></div>
      </form>
      <div id="form-message" style="display:none; margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.7); border-radius: 5px; color: white; text-align: center;"></div>
    </section>

  <!-- force update -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // --- Блок изменения стилей кнопки полностью удалён ---

      // Обработчик отправки формы
      const registrationForm = document.getElementById('registration-form-api');
      if (registrationForm) {
        registrationForm.addEventListener('submit', async function(e) {
          e.preventDefault(); 
          const form = e.target; 
          const submitButton = form.querySelector('button[type="submit"]');
          const messageDiv = document.getElementById('form-message');
          
          const nameInput = form.elements['f_1'];
          const lastNameInput = form.elements['f_2'];
          const phoneInput = form.elements['phone'];
          const emailInput = form.elements['email'];
          const consentCheckbox = form.elements['argument-with-terms'];

          function setFieldError(inputElement, message) {
            const errorBlock = inputElement.closest('td').querySelector('.error-block');
            if (errorBlock) {
              errorBlock.textContent = message;
              errorBlock.style.display = message ? 'block' : 'none';
            }
            if (message) messageDiv.style.display = 'none';
          }
          function clearAllFieldErrors() {
            setFieldError(nameInput, '');
            setFieldError(lastNameInput, '');
            setFieldError(phoneInput, '');
            setFieldError(emailInput, '');
          }

          messageDiv.style.display = 'none'; 
          clearAllFieldErrors(); 

          const name = nameInput.value.trim();
          const lastName = lastNameInput.value.trim();
          const email = emailInput.value.trim();
          const phone = phoneInput.value.trim();

          let isValid = true;

          if (!name) {
            setFieldError(nameInput, 'Пожалуйста, введите ваше имя.');
            isValid = false;
          }
          if (!lastName) {
            setFieldError(lastNameInput, 'Пожалуйста, введите вашу фамилию.');
            isValid = false;
          }
          if (!email) {
            setFieldError(emailInput, 'Пожалуйста, введите ваш email.');
            isValid = false;
          } else if (email.indexOf('@') === -1) {
            setFieldError(emailInput, 'Email должен содержать символ @.');
            isValid = false;
          }
          const phoneRegex = /^(?:\+7|8)\d{10}$/;
          if (!phone) {
            setFieldError(phoneInput, 'Пожалуйста, введите ваш телефон.');
            isValid = false;
          } else if (!phoneRegex.test(phone)) {
            setFieldError(phoneInput, 'Телефон должен начинаться с +7 или 8 и содержать 10 цифр после префикса. Например: +79001234567 или 89001234567.');
            isValid = false;
          }

          // Только для чекбокса показываем ошибку под ним
          const consentErrorBlock = document.getElementById('consent-error');
          if (consentErrorBlock) consentErrorBlock.style.display = 'none';
          if (consentCheckbox && !consentCheckbox.checked) {
              if (consentErrorBlock) {
                  consentErrorBlock.textContent = 'Пожалуйста, подтвердите согласие с политикой конфиденциальности.';
                  consentErrorBlock.style.display = 'block';
              }
              isValid = false; 
          } else {
              if (consentErrorBlock) consentErrorBlock.style.display = 'none';
          }

          if (!isValid) {
            submitButton.disabled = false;
            submitButton.textContent = 'Регистрация';
            return; 
          }
          
          const formData = { f_1: name, f_2: lastName, email: email, phone: phone };
          
          submitButton.disabled = true; 
          submitButton.textContent = 'Отправка...';

          try {
            const response = await fetch('http://localhost:3000/api/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData)
            });
            const result = await response.json();

            if (response.ok) {
              messageDiv.textContent = result.message;
              messageDiv.style.background = 'rgba(0, 128, 0, 0.7)';
              form.reset();
            } else {
              console.error('Backend error details:', result);
              messageDiv.textContent = 'Ошибка: ' + (result.message || 'Не удалось отправить данные.');
              messageDiv.style.background = 'rgba(255, 0, 0, 0.7)';
            }
          } catch (error) {
            console.error('Fetch error details:', error);
            messageDiv.textContent = 'Ошибка сети или сервер недоступен. Попробуйте позже.';
            messageDiv.style.background = 'rgba(255, 0, 0, 0.7)';
          } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'Регистрация';
            messageDiv.style.display = 'block';
          }
        });
      }
    });
  </script>
</body>
</html>
